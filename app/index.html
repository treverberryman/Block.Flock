<!DOCTYPE html>
<html>

<head>
  
  <title>FeatherCoin - Default Truffle App</title>
  
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  
  <link href="./app.css" rel='stylesheet' type='text/css'>
  
  <script src="./app.js"></script>

</head>

<body>

  <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
  integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
  crossorigin="anonymous"></script>

  <script src="https://unpkg.com/ipfs/dist/index.min.js"></script>
  <script src="https://unpkg.com/ipfs/dist/index.js"></script>
  
  <h1>Block.Flock</h1>
  
  <br><br>
  
  <h2>√êapp To Send Your Files</h2>
  
  <h3>You have <span class="black"><span id="balance"></span> FeatherCoin</span></h3>

  <br>

  <h1>Select File(s)</h1>

  <br>

  <input type="file" id="files" name="files[]" multiple />
  <output id="list"></output>

  <br>

  <script>
    function handleFileSelect(evt) {
      var files = evt.target.files; // FileList object

      // files is a FileList of File objects. List some properties.
      var output = [];
      for (var i = 0, f; f = files[i]; i++) {
        output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
      }
      document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    }
    document.getElementById('files').addEventListener('change', handleFileSelect, false);
  </script>

  <br>

  <h1>Make Hash</h1>

  <br>

  <script id="storehash">
    //var ipfs = require('ipfs-api')();
    var ipfs = window.IpfsApi('localhost', '5001');
    function store() {
      var toStore = document.getElementById('files[]').value;
      //TODO un-break this call:
        if(typeof Buffer != 'undefined' && Buffer.prototype) {
          ipfs.files.add(new Buffer(toStore), function (err, res) {
            if(err || !res) return console.error("ipfs add error", err, res);
              res.forEach(function(file) {
                console.log('successfully stored', file.Hash);
                display(file.Hash); 
              });
            });
        }
        document.getElementById('store').onclick = store();
      }
      
  </script>


  <button src="storehash" id="hashit" onclick="store()">Hash It</button>
  <!-- <output id="files[]"><output> -->

  <br>

  <button id="showhash" onclick="display()">Show Hash</button>

  <br>

  <script>
    var ipfs = window.IpfsApi('localhost', '5001');
    function display(hash) {
      ipfs.cat(hash, function(err, res) {
        if(err || !res) return console.error("ipfs cat error", err, res);
          if(res.readable) {
            console.error('unhandled: cat result is a pipe', res);
          } 
          else {
            document.getElementById('hash').innerText=hash;
            document.getElementById('content').innerText=res;
          }
        });
    }
  </script>
  
  <br>

  <h1>Send</h1>
  
  <br><label for="amount">Amount:</label><input type="text" id="amount" placeholder="e.g., 95"></input>
  
  <br><label for="receiver">To Address:</label><input type="text" id="receiver" placeholder="e.g., 0x93e66d9baea28c17d9fc393b53e3fbdd76899dae"></input>
  
  <br><br><button id="send" onclick="sendCoin()">Send File</button>
  
  <br><br>

  <span id="status"></span>
  
</body>

</html>
