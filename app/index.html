<!DOCTYPE html>
<html>

<head>
  
  <title>FeatherCoin - Default Truffle App</title>
  
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  
  <link href="./app.css" rel='stylesheet' type='text/css'>

  <script src="https://unpkg.com/ipfs/dist/index.js"></script>

  <script src="https://unpkg.com/ipfs-api/dist/index.js"></script>
  
  <script type="text/javascript" src="./app.js"></script>

  <script>
	var ipfs = window.IpfsApi('127.0.0.1', '5001');
    
    function handleFileSelect(evt) {
      var files = evt.target.files; // FileList object

      // files is a FileList of File objects. List some properties.
      var output = [];
      for (var i = 0, f; f = files[i]; i++) {
        output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
      }
      document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    }
    document.getElementById('source').addEventListener('change', handleFileSelect, false);
  
  function store() {
    var toStore = document.getElementById('source').value;
      //TODO un-break this call:
      if(typeof Buffer != 'undefined' && Buffer.prototype) {
        ipfs.add(new Buffer(toStore), function (err, res) {
          if(err || !res) return console.error("ipfs add error", err, res);
            res.forEach(function(file) {
              console.log('successfully stored', file.Hash);
              display(file.Hash); 
            });
          });
    }
  }
    function display(hash) {
      ipfs.cat(hash, function(err, res) {
        if(err || !res) return console.error("ipfs cat error", err, res);
          if(res.readable) {
            console.error('unhandled: cat result is a pipe', res);
          } 
          else {
            document.getElementById('hash').innerText=hash;
            document.getElementById('content').innerText=res;
          }
        });
    }
    //document.getElementById('source').onclick=store;
  </script>
</head>

<body>
  
  <h1>Block.Flock</h1>
  
  <br><br>
  
  <h2>√êapp To Send Your Files</h2>
  
  <h3>You have <span class="black"><span id="balance"></span> FeatherCoin</span></h3>

  <br>

  <h1>Select File(s)</h1>

  <br>

  <h1>Make Hash</h1>

  <br>

  <input type="file" id="source" name="files[]" multiple />
  <output id="list"></output>

  <button id="hashit" onclick="store">Hash It</button>

  <br>

  <button id="showhash">Show Hash</button>
  
  <br>

  <h1>Send</h1>
  
  <br><label for="amount">Amount:</label><input type="text" id="amount" placeholder="e.g., 95"></input>
  
  <br><label for="receiver">To Address:</label><input type="text" id="receiver" placeholder="e.g., 0x93e66d9baea28c17d9fc393b53e3fbdd76899dae"></input>
  
  <br><br><button id="send" onclick="sendCoin()">Send File</button>
  
  <br><br>

  <span id="status"></span>
  
</body>

</html>
